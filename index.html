<!DOCTYPE html>
<html>
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
		<title>Fenni Sözlük</title>
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
		<style type="text/css">
		/*normalize*/
		article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section,summary{display:block}audio,canvas,video{display:inline-block;*display:inline;*zoom:1}audio:not([controls]){display:none;height:0}[hidden]{display:none}html{font-size:100%;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}html,button,input,select,textarea{font-family:sans-serif}body{margin:0}a:focus{outline:thin dotted}a:active,a:hover{outline:0}h1{font-size:2em;margin:.67em 0}h2{font-size:1.5em;margin:.83em 0}h3{font-size:1.17em;margin:1em 0}h4{font-size:1em;margin:1.33em 0}h5{font-size:.83em;margin:1.67em 0}h6{font-size:.67em;margin:2.33em 0}abbr[title]{border-bottom:1px dotted}b,strong{font-weight:bold}blockquote{margin:1em 40px}dfn{font-style:italic}hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}mark{background:#ff0;color:#000}p,pre{margin:1em 0}code,kbd,pre,samp{font-family:monospace,serif;_font-family:'courier new',monospace;font-size:1em}pre{white-space:pre;white-space:pre-wrap;word-wrap:break-word}q{quotes:none}q:before,q:after{content:'';content:none}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sup{top:-0.5em}sub{bottom:-0.25em}dl,menu,ol,ul{margin:1em 0}dd{margin:0 0 0 40px}menu,ol,ul{padding:0 0 0 40px}nav ul,nav ol{list-style:none;list-style-image:none}img{border:0;-ms-interpolation-mode:bicubic}svg:not(:root){overflow:hidden}figure{margin:0}form{margin:0}fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}legend{border:0;padding:0;white-space:normal;*margin-left:-7px}button,input,select,textarea{font-size:100%;margin:0;vertical-align:baseline;*vertical-align:middle}button,input{line-height:normal}button,select{text-transform:none}button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer;*overflow:visible}button[disabled],html input[disabled]{cursor:default}input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0;*height:13px;*width:13px}input[type="search"]{-webkit-appearance:textfield;-moz-box-sizing:content-box;-webkit-box-sizing:content-box;box-sizing:content-box}input[type="search"]::-webkit-search-cancel-button,input[type="search"]::-webkit-search-decoration{-webkit-appearance:none}button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}textarea{overflow:auto;vertical-align:top}table{border-collapse:collapse;border-spacing:0}
		/*normalize*/

		.fenni {
			width: 800px;
			margin:0 auto;
			margin-top: 10%;
			padding:20px;
			-webkit-box-sizing: border-box;
			-moz-box-sizing: border-box;
			-ms-box-sizing: border-box;
			box-sizing: border-box;
			-webkit-transition: all 0.1s linear 0s;
			-moz-transition: all 0.1s linear 0s;
			-o-transition: all 0.1s linear 0s;
			transition: all 0.1s linear 0s;
		}

		.press .fenni {
			padding:0;
			margin-top:0;
			width: 100%;
		}

		.press .fenni header {
			overflow: hidden;
			float: left;
			width: 100%;
			background: #ededed;
			padding:20px;
			-webkit-box-sizing: border-box;
			-moz-box-sizing: border-box;
			-ms-box-sizing: border-box;
			box-sizing: border-box;
		}

		.fenni header h1 i {
			font-style: normal;
		}

		.press .fenni h1 {
			width: 20%;
			float: left;
			margin:12px 0;
		}

		.press .fenni .query {
			float: left;
			width: 80%;
		}

		.press .fenni #results {
			overflow: hidden;
			float: left;
			width: 100%;
			padding:10px 20px;
			-webkit-box-sizing: border-box;
			-moz-box-sizing: border-box;
			-ms-box-sizing: border-box;
			box-sizing: border-box;
		}

		blockquote {
			font-family: "Georgia", serif;
			color: #666;
			font-style: italic;
			line-height: 1.8;
			border-left: 5px solid #ddd;
			padding-left: 1.5em;
		}

		.query {
			background-color:#fff;
			color:#696969;
			font-family: Arial;
			font-size: 16px;
			border:1px solid #ccc;
			padding: 20px;
			width: 100%;
			-webkit-box-sizing: border-box;
			-moz-box-sizing: border-box;
			-ms-box-sizing: border-box;
			box-sizing: border-box;
		}

		.query:focus {
			outline: 0;
			border:1px solid #888888;
		}

		a.suggest {
			text-decoration: none;
			background-color: #ededed;
			color: #000;
			padding: 2px 5px;
			margin-right: 5px;
		}

		a.suggest:hover {
			text-decoration: underline;
		}

		@media screen and (max-width:1070px)  {
			.press .fenni h1{
				font-size: 22px;
				margin:7px 0;
			}
			.press .fenni h1 i {
				display: block;
			}
		}

		@media screen and (max-width:800px)  {
			.fenni {
				width: 100%;
			}
		}

		@media screen and (max-width:512px)  {
			.press .fenni h1{
				width: 100%;
			}
			.press .fenni h1 i {
				display: inline;
			}
			.press .fenni .query {
				width: 100%;
			}

			.fenni {
				margin-top:0;
			}
			.fenni h1 {
				margin-top: 0;
			}
		}
		</style>
		<script src="minified-legacyie.js"></script>
	</head>
	<body>
		<div class="fenni">
			<header>
				<h1>Fenni <i>Sözlük</i></h1>
				<input id="q" type="text" class="query" placeholder="Aramak istediğin sözcüğü yaz" required autofocus autocomplete="off"/>
			</header>
			<div id="results" />
		</div>
		<script type="text/javascript">
		var MINI = require('minified');
		var _=MINI._, $=MINI.$, $$=MINI.$$, EE=MINI.EE, HTML=MINI.HTML;

		var xhr = null;
		var ajax = function(url, paramName, paramValue, cb) {
			if(xhr) xhr.abort();
			url += '?' + encodeURIComponent(paramName) + '=' + encodeURIComponent(paramValue);
			xhr = window.XMLHttpRequest ? new XMLHttpRequest() : new ActiveXObject("Msxml2.XMLHTTP.3.0");
			xhr['open']('GET', url, true);
			xhr['onreadystatechange'] = function() {
				try {
					if (xhr['readyState'] == 4 && xhr['status'] == 200) {
						cb($.parseJSON(xhr.responseText));
					}
				} catch(ex) {}
			}
			xhr['send'](null);
		}

		var suggest = function($div, suggest) {
			var term = suggest.term[0];
			if(term.options.length > 0) {
				$div.add(HTML('{{each options}}<a class="suggest" href="#{{this.text}}">{{this.text}}</a>{{/each}}',
					{options: term.options}));
			}
		}

		$(function() {
			var $results = $('#results'),
				$q = $('#q'),
				$suggest = $('.suggest'),
				press = false,
				timeout = null;

			var query = function(q) {
				ajax('http://sozluk.io:8080/ks', 'q', q, function(json) {
					var hits = json.hits;
					if(hits.total == 0) {
						$results.fill(HTML('<h3>Sonuç yok</h3>'));
						suggest($results, json.suggest);
					} else {
						var best = hits.hits[0]._source.k;
						ajax('http://sozluk.io:8080/qts', 'q', best, function(json) {
							var dataQuotes = json.hits;
							if(dataQuotes.hits.length > 0) {
								hits.hits[0]["quote_v"] = dataQuotes.hits[0]._source.v;
								hits.hits[0]["quote_k"] = dataQuotes.hits[0]._source.k;
							}
							$results.fill(HTML('{{each hits}}<h3>{{this._source.k}}</h3><ul>'+
								'{{each this._source.v}}<li>{{this}}</li>{{/each}}'+
								'</ul>{{if this.quote_v}}<blockquote>{{this.quote_v}}<br/><small>{{this.quote_k}}</small></blockquote>{{/if}}{{/each}}',
								{hits: hits.hits}));
						});
					}
				});
			}

			var navigate = function() {
				var hash = window.location.hash.substr(1);
				if(hash && hash.length > 0) {
					hash = decodeURIComponent(hash);
					query(hash);
					$q.set('value', hash);
					if(!press) { $('body').set('+press'); }
				}
			}

			navigate();

			$(window).on('hashchange', navigate);

			$q.on('keyup', function() {
				if(!press) { $('body').set('+press'); }
				var q = $q.get('value');
				if(q.length == 0) return;
				if(timeout) clearTimeout(timeout);
				timeout = setTimeout(function() {
					query(q);
				}, 61);
			});
		});
		</script>
	</body>
</html>
